# bdavinfo version 2.1
bdavinfoはBDAVディスクの情報をテキスト出力するツールです。

このツールの使用は使用者の自己責任において行って下さい。  
このツールの使用によってもたらされた如何なる結果にも作者は一切責任を負いません。  
大事なファイルはバックアップしましょう。

## 使い方
コマンドプロンプトから以下のように実行して下さい。

```
bdavinfo 読み込みファイル名 出力ファイル名 [-オプションスイッチ] [enter]
```

読み込みファイル名には、BDAVディスク上のinfo.bdavファイルを指定します。  
info.bdavファイルからプレイリスト情報を取得し、そのプレイリストに対応するrplsファイルから
番組情報を取得して、テキスト情報として出力ファイルに出力します。

出力ファイル名を省略した場合は、情報をコマンドプロンプト画面に出力します。

実行例： 

```
bdavinfo d:\BDAV\info.bdav e:\test1.txt -D -fcb [enter]
```

スイッチ [-D] [-TSC] [-fdtpzaocnsbieg] [-y] の指定は以下のとおりです。

| | |
| -- | -- |
| -D | BDAVディスク名を出力します。|

次のスイッチは出力形式の指定に関するスイッチです。

| | |
| -- | -- |
| 指定無し | デフォルトで簡易コンマ区切りで出力します。各項目はコンマ文字で区切られます。 <br />各項目中の改行などの制御文字、及びコンマ文字は省略され出力されません。|
| -T | 各項目をタブ文字区切りで出力します。<br />各項目中の改行などの制御文字は省略され出力されません。 |
| -S | 各項目を半角スペース文字区切りで出力します。<br />各項目中の改行などの制御文字は省略され出力されません。|
| -C | 正式なCSV形式で出力します。各項目の前後は「"」で括られ、項目中の「"」は「"」でエスケープされます。区切り文字はコンマです。改行などの制御文字もそのまま出力します。 |

以下は番組情報の出力に関するスイッチです。情報を出力したい順番に、まとめて指定して下さい。

| | |
| -- | -- |
| -f | rplsファイル名を出力します。 |
| -j | m2tsファイル名を出力します。 |
| -k | m2tsファイルサイズを出力します。 |
| -d | 録画した日付を YY/MM/DD 形式で出力します。|
| -t | 録画開始時刻を HH:MM:SS 形式で出力します。|
| -p | 録画期間(録画時間)を HH:MM:SS 形式で出力します。|
| -z | タイムゾーン設定値を出力します。|
| -a | メーカーIDを出力します。
| -o | メーカー機種コードを出力します。
| -c | 放送局名を出力します。
| -n | チャンネル番号を 000ch のように 3桁の数字+ch で出力します。<br />番号が999を超える場合はそのまま出力します。|
| -s | 放送種別情報を出力します（パナ製レコーダのみ対応）。|
| -b | 番組名を出力します。|
| -i | 番組内容情報を出力します。|
| -e | 番組内容詳細情報を出力します（ソニー製レコーダのみ対応）。|
| -g | 番組ジャンル情報を出力します。|

指定例：-cdbf	局名,日付,番組名,ファイル名の順に出力します。

自作のBDAVディスク等、コピー制御されていないBDAVディスクの場合、m2tsファイル側から
番組情報を取得する以下のオプションが使用可能です。

| | |
| -- | -- |
| -Md | 番組放送日付を YY/MM/DD 形式で出力します。|
| -Mt | 番組開始時刻を HH:MM:SS 形式で出力します。|
| -Mp | 番組放送時間(番組長)を HH:MM:SS 形式で出力します。|
| -Mc | 放送局名を出力します。|
| -Mn | チャンネル番号を 000ch のように 3桁の数字+ch で出力します。|
| -Mb | 番組名を出力します。|
| -Mi | 番組内容情報を出力します。|
| -Me | 番組内容詳細情報を出力します。|
| -Mg | 番組ジャンル情報を出力します。|

以下はその他スイッチ [-y][-u][-q]です。これらは必要に応じて指定して下さい。

| | |
| -- | -- |
| -y | 番組情報読み込み時に、英数文字に対して文字サイズ指定(NSZ, MSZ)を反映させます。|
| -u | 複数の異なる字体が存在する文字(葛, 辻, 祇など)の出力時、その区別に異体字セレクタを使用する．|
| -q | ファイル出力時、BOM(バイトオーダーマーク)を付与しない。|

## 注意点
本ツールは主にWindows10で動作を確認しています。開発環境はVisualStudio2015です。

出力ファイルデータはユニコード形式(UTF-16 LE)です。  
出力ファイルとして指定したファイルが既に存在していた場合、そのファイルに追記します。  
この際、既存ファイルのテキストエンコーディング設定に関わらずユニコード形式で追記しますので
注意して下さい。

シフトJIS形式で出力を受けたい場合は、出力ファイル名を指定せず、コマンドプロンプト出力として
それをリダイレクト(>, >>)でファイルに受けて下さい。但しこの場合は一部のユニコード文字が
失われます。あるいは出力がシフトJIS形式の、Version 1.1を使用することも可能です。

info.bdavファイル内のプレイリストに対応するrplsファイルが所定の場所に存在しなかったり、何らか
の原因でrplsファイルを読み込むことが出来なかった場合、番組情報項目には、空欄や "n/a" 等が表示
されます。

パナソニック製レコーダで録画した番組では、-s, -gオプションで放送種別情報、番組ジャンル情報を
出力できます。iLink経由で録画された番組では、レコーダ側の仕様により、チャンネル番号は"65535ch"
となります。

ソニー製レコーダで録画した番組で、番組内容詳細情報、番組ジャンル情報が存在する場合は、-e, -g
オプションでそれらを出力できます。

番組名等に含まれる特殊な文字である「追加記号」と「追加漢字」は、Windows側で表示できる文字列
に変換されて出力されます。それらについて詳しくはrplsTOOLのreadme.txtを参照してください。

## 更新履歴
| | |
| -- | -- |
| Version 2.1 | 文字コード変換ルーチンを更新しました。|
| Version 2.0 | 文字コード変換ルーチンを更新しました。<br />m2tsファイルからの各種情報取得オプションを追加しました。|
| Version 1.5 | m2tsファイル名，ファイルサイズ情報の出力に対応しました。|
| Version 1.4 | パナソニック製レコーダの番組ジャンル情報、放送種別情報に対応しました。|
| Version 1.3 | -a, -o, -yオプションを追加しました。|
| Version 1.2 | 出力をUNICODE形式に変更しました。<br />オプションを一部廃止、追加しました。|
| Version 1.1 | まともなCSV形式で出力できるオプションを追加しました。|
| Version 1.0 | 最初のバージョン。|

# ソースファイルについて

本ツールはVisualStudio2015で作成されています。  
対応するプロジェクトファイルを開くか、新規プロジェクトを作成してファイルを
追加すればビルドできます。

bdavinfo2フォルダ	bdavinfoプロジェクト

ソースファイル（一部分、あるいは全体）の使用に制限はありません。  
何か使える機会があれば自由に使ってください。

但し、ソースファイルの使用によってもたらされた如何なる結果にも作者は一切責任を
負いません。
